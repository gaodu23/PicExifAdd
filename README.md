# PicExifAdd 批量照片地理信息写入工具

## 功能概述
PicExifAdd 是一个用于批量为 JPG/JPEG 照片添加地理信息（GPS/EXIF/XMP）的 Python 工具，支持无人机航拍照片的专业处理。主要功能如下：

- 支持批量处理照片，自动写入 GPS 坐标、高度、姿态角（Roll/Pitch/Yaw）、拍摄时间等 EXIF 信息。
- 支持 DJI XMP 格式（如环境支持 libxmp），可写入 DJI 专用元数据。
- 支持 OPT 文件解析，自动写入焦距、35mm 等效焦距、相机畸变参数。
- 支持 4 列或 8 列 CSV 格式：
  - 4 列：纬度、经度、高度、文件名
  - 8 列：文件名、时间、经度、纬度、高度、Pitch、Roll、Yaw
- 自动校验 CSV 与照片文件名是否匹配，缺失或不符自动跳过。
- 输出照片自动重命名为“处理时的年月日时分秒+原照片名后四位”，防止重名。
- 自动生成新旧照片名对照表（CSV），便于查找和溯源。
- 支持命令行交互和批处理脚本。

## 使用方法

### 1. 安装依赖
- Python 3.7 及以上
- 必需库：Pillow、piexif、pandas
- 可选库：libxmp（如需写入 DJI XMP 格式）、opt_converter.py（如需写入焦距/畸变参数）

安装依赖：
```shell
pip install pillow piexif pandas
```

### 2. 准备 CSV 文件
- 可用 Excel 或文本编辑器编辑，保存为 UTF-8 编码。
- 示例格式：

4 列格式：
```
纬度,经度,高度,文件名
39.9042135,116.4074582,100.25,IMG_001.jpg
```

8 列格式：
```
文件名,时间,经度,纬度,高度,Pitch,Roll,Yaw
IMG_001.jpg,2024-08-18 10:30:00,116.4074582,39.9042135,100.25,8.7,15.2,45.0
```

### 3. 批量处理图片
运行主程序：
```shell
python batch_add_gps_info.py
```
根据提示输入 CSV 文件路径和图片文件夹路径。

处理完成后：
- 输出照片自动重命名并保存到指定目录（如设置 output_dir）。
- 自动生成新旧照片名对照表（如 250908095245.csv），包含原 CSV 数据和新照片名。

### 4. 创建示例 CSV 文件
主菜单选择“创建示例CSV文件”，可快速生成标准格式样例。

### 5. 进阶功能
- 支持 OPT 文件：在参数中指定 opt_file，可自动写入焦距、畸变参数。
- 支持 XMP 写入：如环境安装 libxmp 库，自动写入 DJI XMP 元数据。
- 支持批处理脚本：可结合 batch_process_env.py 实现多目录批量处理。

## 输出说明
- 新照片名格式：年月日时分秒+原照片名后四位（如 2509080952450001.jpg）
- 新旧照片名对照表：自动生成，便于查找和溯源。
- 日志输出：处理进度、成功/失败/跳过统计、详细错误信息。

## 常见问题
- CSV 列数不足或格式错误会自动跳过并提示。
- 照片文件不存在会自动跳过并提示。
- EXIF 写入失败会记录详细错误。
- XMP 写入需 libxmp 库支持，未安装则自动跳过。

## 联系与反馈
如有问题或建议，请联系项目维护者 gaodu23。

---
本工具适用于无人机航拍、测绘、地理信息批量处理等场景，欢迎扩展和定制！
